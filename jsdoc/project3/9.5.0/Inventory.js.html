<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Inventory.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Inventory.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useState, useEffect } from 'react';
import * as React from 'react';
import {
  TextField, Button,
  Typography, Paper,
  Table, TableBody,
  TableCell, TableHead,
  TableRow, TableContainer, 
  Grid
} from "@material-ui/core";
import {orange} from '@mui/material/colors'; 
import Dialog from '@mui/material/Dialog';
import DialogActions from '@mui/material/DialogActions';
import DialogContent from '@mui/material/DialogContent';
import DialogContentText from '@mui/material/DialogContentText';
import DialogTitle from '@mui/material/DialogTitle';

import './ManagerView.css';

import { BACKEND_IP } from './BackendConnection';

/**
 * map of all the names of the col
 */
const stock_column_name_map = {
  stock_id: "ID",
  stock_display_name: "Name",
  stock_amount: "Amount",
  stock_units: "Units",
  minimum_amount: "Minimum Amount"
}


const stock_column_names = Object.entries(stock_column_name_map).map(([sql_column, display_name]) => display_name)
const stock_column_names_sql = Object.entries(stock_column_name_map).map(([sql_column, display_name]) => sql_column)


const itemtype_column_name_map = {
  itemtype_id: "ID",
  item_display_name: "Name",
  item_price: "Price",
  is_hidden: "Delete"
}

const itemtype_column_names = Object.entries(itemtype_column_name_map).map(([sql_column, display_name]) => display_name)
const itemtype_column_names_sql = Object.entries(itemtype_column_name_map).map(([sql_column, display_name]) => sql_column)



/**
 * Inventory Scene that has the 
 * stock table and the items tables
 * @param {*} props 
 * @returns The scene of the inventory 
 */
function Inventory(props) {
  // New Seasonal Item Popup Window Functions
  const [open, setOpen] = useState(false);

  // For seasonal item
  const [itemName, setItemName] = useState(undefined);
  const [itemPrice, setItemPrice] = useState(undefined);

  const handleClickOpen = () => {
    setOpen(true);
  };

  const handleClose = () => {
    //doesnt save text fields
    setOpen(false);
  };

  const handleOkClose = () => {
    //saves text field
    console.log(itemName, itemPrice)
    
    fetch(`${BACKEND_IP}/newSeasonalItem?name=${itemName}&amp;price=${itemPrice}`).then((res) => res.json()).then(({new_item_id}) => {
      alert('New seasonal item id = ' + new_item_id)
      loadItems()
    }, alert)
    setOpen(false);
  };

  /**
   * 
   * @param {*} event 
   * @return changes the item name to the desired item name
   */
  function onItemNameChange(event) {
    setItemName(event.target.value)
  }

  /**
   * 
   * @param {*} event 
   * @returns sets the item price to the desired item price
   */
  function onItemPriceChange(event) {
    setItemPrice(event.target.value)
  }

  //For Excess Stock 
  const [excessStock, setExcessStock] = useState("");

  /// useState for Stock 
  const [stockState, setStockState] = useState(null);
  const [itemState, setItemState] = useState(null);

  /**
   * @returns Loads stocks into our table from the backend
   */
  function loadStocks() {
    fetch(`${BACKEND_IP}/stocks/load`).then((res) => res.json()).then((stockState) => {
      setStockState(stockState)
    }, alert)
  }

  /**
   * @returns Loads items into our table from the backend
   */
  function loadItems() {
    fetch(`${BACKEND_IP}/itemtypes?exclude_hidden=1`).then((res) => res.json()).then((itemState) => {
      setItemState(itemState)
    }, alert)
  }
  // load the stocks first
  useEffect(() => {
    loadStocks()
    loadItems()
  }, [])

  //Exit Button
  const exit = &lt;div class="exit">&lt;button onClick={() => props.onFormSwitch("manager_view")} type="submit" class="exit_text">Exit&lt;/button>&lt;/div>

  return &lt;div class='background'>
    {/* &amp;nbsp; is a character entity that denotes a non-breaking or fixed space */}
    {exit}
    &lt;Typography variant="h2" align='center' style={{ marginBottom: "3%", color: "#f7ca28" }}>Inventory&lt;/Typography>
    {
      (stockState == null || itemState == null) ?
        &lt;h1> loading &lt;/h1> : &lt;div>

          &lt;Grid container columnSpacing={{ xs: 1, sm: 2, md: 3 }}>
          {/*Menu table */}
          {          
          &lt; Grid item xs={6}>
            &lt;div  class = "divLeft">
            &lt;button class =  "yellowbtn" onClick={handleClickOpen}>
              New Seasonal Item
            &lt;/button>
          
            &lt;/div>
            &lt;TableContainer component={Paper} style={{ margin: '10px', width: 550, marginLeft: '10%' }}>
              &lt;Table sx={{ minWidth: 350 }} size="small" aria-label="a dense table">
                &lt;TableHead style={{ backgroundColor: "#f7ca28", fontFamily: 'nunito' }}>
                  &lt;TableRow>
                    {itemtype_column_names.map((column_name) => {
                      return &lt;TableCell sx={{ width: 100 }}>{column_name}&lt;/TableCell>
                    })}
                  &lt;/TableRow>
                &lt;/TableHead>
                &lt;TableBody> {
                  itemState.toSorted((a,b)=>a.itemtype_id > b.itemtype_id).map((row, index) => {

                    return (&lt;TableRow key={
                      row.itemtype_id
                      }>
                      {
                        itemtype_column_names_sql.map((sql_name) => {
                          const valueString = '' + (row[sql_name])
                          return (&lt;TableCell>
                            &lt;TextField defaultValue={valueString}
                            onKeyPress={(event)=>{
                              if(event.key === "Enter") {
                              // Update table

                                // Show loading...
                                setItemState(null)
                                
                                // Then fetch update
                                fetch(`${BACKEND_IP}/updateItems?itemtype_id=${row.itemtype_id}&amp;${sql_name}=${event.target.value}`).then((res)=>{
                                  if(res.status != 200) {
                                    throw Error(res.text())
                                  }
                                  return res.json()
                                }).then((new_items)=>{
                                  setItemState(new_items)
                                }, (err)=>{
                                  // Show error
                                  console.log(err)
                                  // Reload stocks
                                  loadItems()
                                })
                              }
                            }}>

                            &lt;/TextField>
                          &lt;/TableCell>)
                        })
                      }
                    &lt;/TableRow>)
                  })
                }
                &lt;/TableBody>
              &lt;/Table>
            &lt;/TableContainer>
            &lt;div  style = {{marginLeft:"9%"}}>
            &lt;Dialog open={open} onClose={handleClose}>
              &lt;DialogTitle style={{background:'#9e9e9e', opacity:"60%", color:"black", marginBottom:"5%"}}>New Seasonal Item&lt;/DialogTitle>
              &lt;DialogContent>
                &lt;TextField
                autoFocus
                margin="dense"
                id="name"
                label="Name"
                placeholder='Item Name'
                variant="standard"
                style={{marginRight: "20px", width:"50%"}}
                onChange={onItemNameChange}  
                />
                &lt;TextField
                autoFocus
                margin="dense"
                placeholder='$0.00'
                id="Price"
                label="Price"
                variant='standard'
                style={{marginRight: "20px", width:"30%"}}
                onChange={onItemPriceChange}
                />
              &lt;/DialogContent>
              &lt;DialogActions>
                &lt;button onClick={handleOkClose}>OK&lt;/button>
                &lt;button onClick={handleClose}>Close&lt;/button>
              &lt;/DialogActions>
            &lt;/Dialog>
            &lt;/div>
            &lt;/Grid>}

          {/*Stock Table */}
          &lt; Grid item xs={6}>
          &lt;div class = "divLeft">
            &lt;button class =  "yellowbtn" onClick={()=>{
              setStockState(null);
              loadStocks()}}>Show Stocks&lt;/button>
            &lt;button class =  "yellowbtn" onClick={()=>{
          // Show loading...
          setStockState(null)
          
          // Then fetch update
          fetch(`${BACKEND_IP}/stocks/getLowStocks`).then((res)=>{
            if(res.status != 200) {
              throw Error(res.text())
            }
            return res.json()
          }).then((low_stocks)=>{
            setStockState(low_stocks)
          }, (err)=>{
            // Show error
            alert(err)
            // Reload stocks
            loadStocks()
          })
    }} >Show Low Stocks&lt;/button>
    &lt;TextField
          style={{backgroundColor:"white", marginLeft:"2%", color: "#ffd000"}}
          label="Show Excess Stock"
          variant="filled"
          size="medium"
          
          placeholder='MM-DD-YYYY'
          onKeyPress={(e)=>{
            if(e.key == "Enter") {
              fetch(`${BACKEND_IP}/stocks/getExcessStocksSince?date=${e.target.value}`).then((res)=>{
                if(res.status != 200) {
                  throw Error(res.text())
                }
                return res.json()
              }).then((excess_stocks)=>{
                setStockState(excess_stocks)
              }, (err)=>{
                // Show error
                err.then((e)=>alert(e))
                // Reload stocks
                loadStocks()
              })
            }
          }}
          onChange={(e)=>{}}
          sx={{
            "&amp; .MuiInputBase-root": {
                color: '#ffd000'
            }
        }}
        />
        &lt;/div>
            &lt;TableContainer component={Paper} style={{ margin: '10px', width: 600, marginLeft: "9%" }}>
              &lt;Table sx={{ minWidth: 650 }} size="small" aria-label="a dense table">
                &lt;TableHead style={{ backgroundColor: "#f7ca28", fontFamily: 'nunito' }}>
                  &lt;TableRow>
                    {stock_column_names.map((column_name) => {
                      return &lt;TableCell sx={{ width: 100 }}>{column_name}&lt;/TableCell>
                    })}
                  &lt;/TableRow>
                &lt;/TableHead>
                &lt;TableBody> {
                  stockState.toSorted((a,b)=>a.stock_id > b.stock_id).map((row, index) => {


                    return (&lt;TableRow key={
                      row.stock_id
                      }>
                      {
                        stock_column_names_sql.map((sql_name) => {
                          const valueString = '' + (row[sql_name])
                          return (&lt;TableCell>
                            &lt;TextField defaultValue={valueString}
                            onKeyPress={(event)=>{
                              if(event.key === "Enter") {
                                // Update table

                                // Show loading...
                                setStockState(null)
                                
                                // Then fetch update
                                fetch(`${BACKEND_IP}/stocks/update?stock_id=${row.stock_id}&amp;${sql_name}=${event.target.value}`).then((res)=>{
                                  if(res.status != 200) {
                                    throw Error(res.text())
                                  }
                                  return res.json()
                                }).then((new_stocks)=>{
                                  setStockState(new_stocks)
                                }, (err)=>{
                                  // Show error
                                  console.log(err)
                                  // Reload stocks
                                  loadStocks()
                                })
                              }
                            }}>

                            &lt;/TextField>
                          &lt;/TableCell>)
                        })
                      }
                    &lt;/TableRow>)
                  })
                }
                &lt;/TableBody>
              &lt;/Table>
            &lt;/TableContainer>
            
           &lt;/Grid>
          &lt;/Grid>
        &lt;/div>
        
    }
    
  &lt;/div >
}
export default Inventory;

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#Inventory">Inventory</a></li><li><a href="global.html#OrderHistory">OrderHistory</a></li><li><a href="global.html#SalesReport">SalesReport</a></li><li><a href="global.html#XZReport">XZReport</a></li><li><a href="global.html#getURLParams">getURLParams</a></li><li><a href="global.html#oauth">oauth</a></li><li><a href="global.html#stock_column_name_map">stock_column_name_map</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue May 02 2023 20:57:49 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
